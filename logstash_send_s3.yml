
#receiving the log data from filebeat.
input {
  beats {
    port => 5045
  }
}

## filter config 

filter {

mutate {   
        add_field => { "beat_version" => "%{[beat][version]}" }
    } 
    
mutate {   
        add_field => { "log_file" => "%{[log][file][path]}" }
    }
    
    mutate {   
        add_field => { "beat_input_type" => "%{[input][type]}" }
    }
    
mutate {
        remove_field => ["offset", "prospector","@version","source","host","beat","log","input"]
      }

csv {
skip_header => "true"
separator => ","
columns => ["bookId","name","subject","publisher","author"]
}
}

#send the output to the destination here it is console ans S3 .

 output {
      stdout{}
      s3 {
        access_key_id => "**************"
        secret_access_key => "**************"
        region => "us-east-1"
        bucket => "makinglearnngezy1"
        additional_settings => {
          "force_path_style" => true
          "follow_redirects" => false
        }
        codec => "json_lines"
        temporary_directory => "D:\microservices_project\kibana_setup\6.8\logstash\s3_files"
        size_file => 2048 
      }
    }
